---
import MobileMenu from './MobileMenu.astro';
import Button from '../ui/Button.astro';
---

<nav class="bg-paper py-3 lg:py-6 border-b border-dark/[0.04]" aria-label="Main navigation">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-2 lg:grid-cols-[auto_1fr_auto] items-center gap-2">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 text-lg font-bold text-dark" aria-label="Midsphere home">
        <svg width="32" height="32" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="32" cy="32" r="10" stroke="currentColor" stroke-width="3" class="text-coral" />
          <circle cx="32" cy="32" r="20" stroke="currentColor" stroke-width="2.5" class="text-coral" />
          <circle cx="32" cy="32" r="30" stroke="currentColor" stroke-width="2" class="text-coral" />
        </svg>
        <span>Midsphere</span>
      </a>

      <!-- Desktop Nav -->
      <div class="hidden lg:flex items-center justify-center gap-8">
        <!-- Product dropdown -->
        <div class="nav-dropdown-trigger relative">
          <button type="button" class="flex items-center gap-1 text-sm text-dark hover:text-coral transition-colors">
            Product
            <svg class="nav-chevron h-3.5 w-3.5 text-dark/40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
          </button>
          <div class="nav-dropdown absolute left-1/2 top-full z-50 -translate-x-1/2 pt-2">
            <div class="w-64 rounded-lg border-2 border-dark bg-paper p-3 shadow-sm">
              <a href="/features" class="flex flex-col rounded-md px-3 py-2 hover:bg-subtle transition-colors">
                <span class="text-sm font-semibold text-dark">Features</span>
                <span class="text-xs text-dark/50">Research, build, and automate</span>
              </a>
              <a href="/integrations" class="flex flex-col rounded-md px-3 py-2 hover:bg-subtle transition-colors">
                <span class="text-sm font-semibold text-dark">Integrations</span>
                <span class="text-xs text-dark/50">500+ connected platforms</span>
              </a>
              <a href="/benchmarks" class="flex flex-col rounded-md px-3 py-2 hover:bg-subtle transition-colors">
                <span class="text-sm font-semibold text-dark">Benchmarks</span>
                <span class="text-xs text-dark/50">Industry-leading performance</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Resources dropdown -->
        <div class="nav-dropdown-trigger relative">
          <button type="button" class="flex items-center gap-1 text-sm text-dark hover:text-coral transition-colors">
            Resources
            <svg class="nav-chevron h-3.5 w-3.5 text-dark/40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
          </button>
          <div class="nav-dropdown absolute left-1/2 top-full z-50 -translate-x-1/2 pt-2">
            <div class="w-56 rounded-lg border-2 border-dark bg-paper p-3 shadow-sm">
              <a href="/blog" class="flex flex-col rounded-md px-3 py-2 hover:bg-subtle transition-colors">
                <span class="text-sm font-semibold text-dark">Blog</span>
                <span class="text-xs text-dark/50">Guides and updates</span>
              </a>
              <a href="https://discord.gg/midsphere" target="_blank" rel="noopener noreferrer" class="flex flex-col rounded-md px-3 py-2 hover:bg-subtle transition-colors">
                <span class="text-sm font-semibold text-dark">Community</span>
                <span class="text-xs text-dark/50">Join us on Discord</span>
              </a>
            </div>
          </div>
        </div>

        <a href="/pricing" class="text-sm text-dark hover:text-coral transition-colors">Pricing</a>
      </div>

      <!-- Right side -->
      <div class="flex items-center justify-end gap-3">
        <button
          id="theme-toggle"
          type="button"
          class="hidden lg:flex items-center justify-center rounded-lg p-2 text-dark hover:text-coral transition-colors"
          aria-label="Toggle dark mode"
        >
          <!-- Sun icon (shown in dark mode) -->
          <svg class="theme-icon-sun hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2" /><path d="M12 20v2" />
            <path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" />
            <path d="M2 12h2" /><path d="M20 12h2" />
            <path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" />
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="theme-icon-moon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
          </svg>
        </button>
        <Button href="https://platform.midsphere.ai" isPrimary class="hidden lg:flex text-sm py-3">
          Get started
        </Button>
        <!-- Mobile theme toggle -->
        <button
          type="button"
          class="theme-toggle-mobile lg:hidden flex items-center justify-center rounded-lg p-2 text-dark hover:text-coral transition-colors"
          aria-label="Toggle dark mode"
        >
          <svg class="theme-icon-sun hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2" /><path d="M12 20v2" />
            <path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" />
            <path d="M2 12h2" /><path d="M20 12h2" />
            <path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" />
          </svg>
          <svg class="theme-icon-moon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
          </svg>
        </button>
        <!-- Mobile hamburger -->
        <label for="mobile-menu-toggle" class="lg:hidden cursor-pointer p-2" aria-label="Open menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="3" y1="6" x2="21" y2="6" />
            <line x1="3" y1="12" x2="21" y2="12" />
            <line x1="3" y1="18" x2="21" y2="18" />
          </svg>
        </label>
      </div>
    </div>
  </div>
</nav>

<MobileMenu />

<script>
  function initDropdownClicks() {
    document.querySelectorAll<HTMLElement>('.nav-dropdown-trigger').forEach((trigger) => {
      const btn = trigger.querySelector('button');
      if (!btn) return;
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const dropdown = trigger.querySelector('.nav-dropdown') as HTMLElement | null;
        if (!dropdown) return;
        const isOpen = dropdown.style.opacity === '1';
        // Close all dropdowns first
        document.querySelectorAll<HTMLElement>('.nav-dropdown').forEach((d) => {
          d.style.opacity = '';
          d.style.transform = '';
          d.style.pointerEvents = '';
        });
        if (!isOpen) {
          dropdown.style.opacity = '1';
          dropdown.style.transform = 'translateY(0)';
          dropdown.style.pointerEvents = 'auto';
        }
      });
    });
    document.addEventListener('click', () => {
      document.querySelectorAll<HTMLElement>('.nav-dropdown').forEach((d) => {
        d.style.opacity = '';
        d.style.transform = '';
        d.style.pointerEvents = '';
      });
    });
  }
  initDropdownClicks();
  document.addEventListener('astro:after-swap', initDropdownClicks);
</script>
