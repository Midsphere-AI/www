---
import Button from '../ui/Button.astro';
---

<input type="checkbox" id="mobile-menu-toggle" class="peer sr-only" aria-hidden="true" />

<!-- Overlay -->
<div class="fixed inset-0 z-40 bg-black opacity-0 pointer-events-none peer-checked:opacity-50 peer-checked:pointer-events-auto transition-opacity duration-300" aria-hidden="true">
  <label for="mobile-menu-toggle" class="block h-full w-full cursor-pointer">
    <span class="sr-only">Close menu</span>
  </label>
</div>

<!-- Panel -->
<div class="fixed top-0 right-0 z-50 h-full w-64 translate-x-full bg-paper shadow-lg transition-transform duration-300 peer-checked:translate-x-0">
  <div class="flex items-center justify-between border-b border-subtle p-4">
    <span class="text-lg font-bold text-dark">Menu</span>
    <label for="mobile-menu-toggle" class="cursor-pointer p-2 text-dark hover:text-coral" aria-label="Close menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
      <span class="sr-only">Close menu</span>
    </label>
  </div>
  <nav class="p-4" aria-label="Mobile navigation">
    <ul class="flex flex-col gap-1">
      <!-- Product group -->
      <li>
        <details class="group">
          <summary class="flex cursor-pointer items-center justify-between rounded-lg px-4 py-3 text-dark hover:bg-subtle transition-colors">
            <span>Product</span>
            <svg class="h-4 w-4 text-dark/40 transition-transform group-open:rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <ul class="ml-4 flex flex-col gap-1 pb-1">
            <li>
              <a href="/features" class="block rounded-lg px-4 py-2 text-sm text-dark/70 hover:bg-subtle hover:text-dark transition-colors">Features</a>
            </li>
            <li>
              <a href="/integrations" class="block rounded-lg px-4 py-2 text-sm text-dark/70 hover:bg-subtle hover:text-dark transition-colors">Integrations</a>
            </li>
            <li>
              <a href="/benchmarks" class="block rounded-lg px-4 py-2 text-sm text-dark/70 hover:bg-subtle hover:text-dark transition-colors">Benchmarks</a>
            </li>
          </ul>
        </details>
      </li>
      <!-- Resources group -->
      <li>
        <details class="group">
          <summary class="flex cursor-pointer items-center justify-between rounded-lg px-4 py-3 text-dark hover:bg-subtle transition-colors">
            <span>Resources</span>
            <svg class="h-4 w-4 text-dark/40 transition-transform group-open:rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <ul class="ml-4 flex flex-col gap-1 pb-1">
            <li>
              <a href="/blog" class="block rounded-lg px-4 py-2 text-sm text-dark/70 hover:bg-subtle hover:text-dark transition-colors">Blog</a>
            </li>
            <li>
              <a href="https://discord.gg/midsphere" target="_blank" rel="noopener noreferrer" class="block rounded-lg px-4 py-2 text-sm text-dark/70 hover:bg-subtle hover:text-dark transition-colors">Community</a>
            </li>
          </ul>
        </details>
      </li>
      <!-- Pricing flat link -->
      <li>
        <a href="/pricing" class="block rounded-lg px-4 py-3 text-dark hover:bg-subtle hover:text-coral transition-colors">
          Pricing
        </a>
      </li>
      <li class="mt-4">
        <Button href="https://platform.midsphere.ai" isPrimary class="w-full">
          Get started
        </Button>
      </li>
    </ul>
  </nav>
</div>

<script>
  function initMobileMenuClose() {
    const toggle = document.getElementById('mobile-menu-toggle') as HTMLInputElement | null;
    if (!toggle) return;
    document.querySelectorAll<HTMLAnchorElement>('.peer-checked\\:translate-x-0 a[href*="#"]').forEach((link) => {
      link.addEventListener('click', () => {
        toggle.checked = false;
      });
    });
  }
  initMobileMenuClose();
  document.addEventListener('astro:after-swap', initMobileMenuClose);
</script>
