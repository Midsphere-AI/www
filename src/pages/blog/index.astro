---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import Card from '../../components/ui/Card.astro';
import Badge from '../../components/ui/Badge.astro';
import { formatDate } from '../../utils/formatDate';

const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<PageLayout
  title="Blog"
  description="Insights on AI agents, automation, and building with Midsphere. Tips, benchmarks, and guides for getting the most out of autonomous AI."
  breadcrumbs={[
    { name: 'Home', url: 'https://midsphere.ai' },
    { name: 'Blog', url: 'https://midsphere.ai/blog' },
  ]}
>
  <!-- Hero -->
  <section class="relative overflow-hidden py-20 lg:py-32">
    <div class="absolute inset-0">
      <img src="/images/art/blog.jpg" alt="" class="h-full w-full object-cover" aria-hidden="true" loading="eager" />
      <div class="absolute inset-0 bg-dark/10 backdrop-blur-[1px] [mask-image:linear-gradient(to_top,black,transparent_60%)]"></div>
      <div class="absolute inset-0 bg-dark/20 backdrop-blur-[3px] [mask-image:linear-gradient(to_top,black,transparent_40%)]"></div>
      <div class="absolute inset-0 bg-dark/40 backdrop-blur-[8px] [mask-image:linear-gradient(to_top,black,transparent_25%)]"></div>
    </div>
    <div class="relative mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
      <span class="hero-child inline-flex items-center rounded-full bg-white/10 px-3.5 py-1 text-[11px] font-semibold uppercase tracking-[0.2em] text-white" style="--hero-delay:0">
        Blog
      </span>
      <h1 class="hero-child mt-6 text-4xl font-bold leading-tight tracking-tight text-white sm:text-5xl lg:text-6xl" style="--hero-delay:1">
        Insights, guides, and deep dives
      </h1>
      <p class="hero-child mx-auto mt-6 max-w-2xl text-lg text-white" style="--hero-delay:2">
        Explore AI agents, automation strategies, and practical guides for getting the most out of Midsphere.
      </p>
    </div>
  </section>

  <section class="mx-auto max-w-5xl px-4 py-16 sm:px-6 lg:px-8">

    {posts.length === 0 ? (
      <p class="text-dark/60">No posts yet. Check back soon.</p>
    ) : (
      <div class="grid gap-8 sm:grid-cols-2">
        {posts.map((post) => (
          <a href={`/blog/${post.id}`} class="group block">
            <Card as="article" class="h-full transition-shadow hover:shadow-md">
              {post.data.tags.length > 0 && (
                <div class="mb-3 flex flex-wrap gap-2">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <Badge variant="coral">{tag}</Badge>
                  ))}
                </div>
              )}
              <h2 class="text-xl font-bold group-hover:text-coral transition-colors">
                {post.data.title}
              </h2>
              <p class="mt-2 text-sm text-dark/60 line-clamp-3">
                {post.data.description}
              </p>
              <div class="mt-4 flex items-center gap-3 text-xs text-dark/50">
                <time datetime={post.data.pubDate.toISOString()}>
                  {formatDate(post.data.pubDate)}
                </time>
                <span aria-hidden="true">&middot;</span>
                <span>{post.data.author}</span>
              </div>
            </Card>
          </a>
        ))}
      </div>
    )}
  </section>
</PageLayout>
