---
import '../styles/global.css';
import SEOHead from '../components/global/SEOHead.astro';
import type { BreadcrumbItem } from '../utils/seo';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  canonicalURL?: string;
  ogType?: 'website' | 'article';
  publishedDate?: string;
  modifiedDate?: string;
  author?: string;
  noindex?: boolean;
  breadcrumbs?: BreadcrumbItem[];
  faqItems?: { question: string; answer: string }[];
}

const {
  title,
  description = 'An AI agent that handles any task from a prompt. Build full apps with databases, research topics deeply, create media, or automate workflows across 500+ platforms.',
  ogImage,
  canonicalURL,
  ogType,
  publishedDate,
  modifiedDate,
  author,
  noindex,
  breadcrumbs,
  faqItems,
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <meta name="theme-color" content="#da755b" />
    <SEOHead
      title={title}
      description={description}
      ogImage={ogImage}
      canonicalURL={canonicalURL}
      ogType={ogType}
      publishedDate={publishedDate}
      modifiedDate={modifiedDate}
      author={author}
      noindex={noindex}
      breadcrumbs={breadcrumbs}
      faqItems={faqItems}
    />
    <link rel="preload" href="/fonts/JunicodeVF-Roman.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/JunicodeVF-Italic.woff2" as="font" type="font/woff2" crossorigin />
    <slot name="head" />
  </head>
  <body>
    <script is:inline>
      (function() {
        const stored = localStorage.getItem('theme');
        const preferred = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        const theme = stored || preferred;
        document.documentElement.setAttribute('data-theme', theme);
        if (theme === 'dark') document.documentElement.classList.add('dark');
      })();
    </script>
    <slot />
    <script is:inline>
      (function() {
        function updateIcons(theme) {
          document.querySelectorAll('.theme-icon-sun').forEach(function(el) {
            el.classList.toggle('hidden', theme !== 'dark');
          });
          document.querySelectorAll('.theme-icon-moon').forEach(function(el) {
            el.classList.toggle('hidden', theme !== 'light');
          });
          document.querySelectorAll('.theme-label').forEach(function(el) {
            el.textContent = theme === 'dark' ? 'Light mode' : 'Dark mode';
          });
        }
        function toggleTheme() {
          var current = document.documentElement.getAttribute('data-theme');
          var next = current === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', next);
          document.documentElement.classList.toggle('dark', next === 'dark');
          localStorage.setItem('theme', next);
          updateIcons(next);
        }
        var initial = document.documentElement.getAttribute('data-theme') || 'light';
        updateIcons(initial);
        document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
        document.querySelectorAll('.theme-toggle-mobile').forEach(function(el) {
          el.addEventListener('click', toggleTheme);
        });
      })();
    </script>
    <script is:inline>
      (function() {
        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.05, rootMargin: '0px 0px -40px 0px' });
        document.querySelectorAll('[data-animate]').forEach(function(el) {
          observer.observe(el);
        });
      })();
    </script>
  </body>
</html>
